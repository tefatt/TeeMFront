{"ast":null,"code":"var querystring = require('querystring');\n\nvar xhr = require('xhr');\n\nif (!xhr.open) xhr = require('request');\nvar allowedProperties = ['fields', 'channelId', 'channelType', 'eventType', 'forContentOwner', 'forDeveloper', 'forMine', 'location', 'locationRadius', 'onBehalfOfContentOwner', 'order', 'pageToken', 'publishedAfter', 'publishedBefore', 'regionCode', 'relatedToVideoId', 'relevanceLanguage', 'safeSearch', 'topicId', 'type', 'videoCaption', 'videoCategoryId', 'videoDefinition', 'videoDimension', 'videoDuration', 'videoEmbeddable', 'videoLicense', 'videoSyndicated', 'videoType', 'key'];\n\nmodule.exports = function (term, opts) {\n  return new Promise(function (resolve, reject) {\n    if (typeof opts === 'function') {\n      opts = {};\n    }\n\n    var params = {\n      q: term,\n      part: opts.part || 'snippet',\n      maxResults: opts.maxResults || 30\n    };\n    Object.keys(opts).map(function (k) {\n      if (allowedProperties.indexOf(k) > -1) params[k] = opts[k];\n    });\n    xhr({\n      url: 'https://www.googleapis.com/youtube/v3/search?' + querystring.stringify(params),\n      method: 'GET'\n    }, function (err, res, body) {\n      if (err) throw err;\n\n      try {\n        var result = JSON.parse(body);\n\n        if (result.error) {\n          var error = new Error(result.error.errors.shift().message);\n          throw error;\n        }\n\n        var pageInfo = {\n          totalResults: result.pageInfo.totalResults,\n          resultsPerPage: result.pageInfo.resultsPerPage,\n          nextPageToken: result.nextPageToken,\n          prevPageToken: result.prevPageToken\n        };\n        var findings = result.items.map(function (item) {\n          var link = '';\n          var id = '';\n\n          switch (item.id.kind) {\n            case 'youtube#channel':\n              link = 'https://www.youtube.com/channel/' + item.id.channelId;\n              id = item.id.channelId;\n              break;\n\n            case 'youtube#playlist':\n              link = 'https://www.youtube.com/playlist?list=' + item.id.playlistId;\n              id = item.id.playlistId;\n              break;\n\n            default:\n              link = 'https://www.youtube.com/watch?v=' + item.id.videoId;\n              id = item.id.videoId;\n              break;\n          }\n\n          return {\n            id: id,\n            link: link,\n            kind: item.id.kind,\n            publishedAt: item.snippet.publishedAt,\n            channelId: item.snippet.channelId,\n            channelTitle: item.snippet.channelTitle,\n            title: item.snippet.title,\n            description: item.snippet.description,\n            thumbnails: item.snippet.thumbnails\n          };\n        });\n        resolve(findings, pageInfo);\n      } catch (error) {\n        reject(error);\n      }\n    });\n  });\n};","map":null,"metadata":{},"sourceType":"script"}